apiVersion: v1
kind: Secret
metadata:
  name: github-secret
type: Opaque
stringData:
  secretToken: "1234567"
---
apiVersion: triggers.tekton.dev/v1beta1
kind: EventListener
metadata:
  name: github-listener
spec:
  namespaceSelector: {}
  resources: {}
  serviceAccountName: pipeline
  triggers:
    - bindings:
        - kind: TriggerBinding
          name: gitrepositoryurl
          value: $(body.repository.html_url)
      interceptors:
        - name: verify-github-payload
          params:
            - name: secretRef
              value:
                secretKey: secretToken
                secretName: github-secret
            - name: eventTypes
              value:
                - push
          ref:
            kind: ClusterInterceptor
            name: github
      name: github-push-events-trigger
      template:
        spec:
          params:
            - name: gitrepositoryurl
          resourcetemplates:
            - apiVersion: tekton.dev/v1
              kind: PipelineRun
              metadata:
                generateName: ecommerce-oracle-
                labels:
                  tekton.dev/pipeline: ecommerce-oracle
              spec:
                params:
                  - name: IMAGE_NAME
                    value: 'image-registry.openshift-image-registry.svc:5000/maximilianopizarro5-dev/ecommerce-oracle'
                  - name: PATH_CONTEXT
                    value: /app
                  - name: MAVEN_IMAGE
                    value: 'registry.redhat.io/ubi8/openjdk-17@sha256:af305e087061cbaa4107ce0b304a1ef987f6b54bae3f75bfd529cfd084cba9b5'
                  - name: APP_JAR_VERSION
                    value: ecommerce-0.0.1-SNAPSHOT.jar
                pipelineRef:
                  name: ecommerce-oracle
                taskRunTemplate:
                  serviceAccountName: pipeline
                timeouts:
                  pipeline: 1h0m0s
                workspaces:
                  - name: workspace
                    volumeClaimTemplate:
                      metadata:
                        creationTimestamp: null
                      spec:
                        accessModes:
                          - ReadWriteOnce
                        resources:
                          requests:
                            storage: 4Gi
                        storageClassName: gp2
                        volumeMode: Filesystem
